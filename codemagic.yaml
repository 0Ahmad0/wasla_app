workflows:
  build_and_notify:
    name: Build APK and Send to Telegram
    max_build_duration: 30
    environment:
      flutter: stable
      vars:
        TELEGRAM_BOT_TOKEN: Encrypted(...)  # Ø§Ø³ØªØ¨Ø¯Ù„ Encrypted(...) Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´ÙØ±Ø© Ù…Ù† Codemagic UI
        TELEGRAM_CHAT_ID: Encrypted(...)    # Ø§Ø³ØªØ¨Ø¯Ù„ Encrypted(...) Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´ÙØ±Ø© Ù…Ù† Codemagic UI

    scripts:
      - name: Install dependencies
        script: |
          flutter pub get

      - name: Build APK (split-per-abi)
        script: |
          flutter build apk --split-per-abi

      - name: Send APK (armeabi-v7a) to Telegram
        script: |
          curl -F document=@build/app/outputs/flutter-apk/app-armeabi-v7a-release.apk \
               -F chat_id=$TELEGRAM_CHAT_ID \
               -F caption="âœ… APK (armeabi-v7a) Ø¬Ø§Ù‡Ø² ğŸ”§" \
               https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendDocument

      - name: Send APK (arm64-v8a) to Telegram
        script: |
          curl -F document=@build/app/outputs/flutter-apk/app-arm64-v8a-release.apk \
               -F chat_id=$TELEGRAM_CHAT_ID \
               -F caption="âœ… APK (arm64-v8a) Ø¬Ø§Ù‡Ø² ğŸš€" \
               https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendDocument

# post:
#   - name: Notify Telegram on Failure
#     condition: failure
#     script: |
#       curl -s -X POST https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage \
#            -d chat_id=$TELEGRAM_CHAT_ID \
#            -d text="âŒ ÙØ´Ù„ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Codemagic!"
